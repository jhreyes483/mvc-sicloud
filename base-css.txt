<?php

if (isset($_SESSION['usuario'])) {
  $obj = new c_notificacion;
  $objs = new Session;
  $s = $objs->desencriptaSesion();
  $notificaciones = $obj->verNotificaciones();
  Controller::ver($notificaciones);
  $not = $obj->notificacionPorRolLogin();
?>

  <!-- 
************************************
Modal notificacion
***********************************
 -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Notificaciones </h5> <i class="fas fa-comment"></i>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-striped bg-bordered bg-white table-sm col-md-10 col-sm-4 col-xs-12 mx-auto">
            <thead>
            </thead>
            <tbody>
<?php
if (isset($_SESSION['usuario'])) {
  foreach ($notificaciones as $row) {
    switch ($row[4]) { // id_notificacion
      case 1: // Activar cuenta admin
        $ruta = 'admin/consulta';
        $m    =  $row['nom_tipo'].' Id usuario: '. $row['descript'];
        $id   =  $row['descript'];
        $ac   =  'bId';
        break;

      case 3: // producto agitado - logistica
        $ruta = '/producto';
        $m    =  $row[5];
        break;
      case 4:// informe mensual - supervisor
        $ruta = 'supervisor/infvrango';
        $m    = $row[5]; 
        break;
       
      case 5: // Reporte de venta pendiente dar permisos en menu usuario 
        if( $s['usuario']['ID_rol_n'] == 4 ){ // si es ventas
          $ruta = 'supervisor/facturas';
          $us   = $s['usuario']['ID_us'];
          $m    = $row[5];
        }
        $ruta = 'supervisor/facturas';
        $m    = $row[5];
      
        break;
      case 8:
        $ruta = 'admin/logActividad';
        $m    =  $row[5];
        $id   = '';
        break; 
      case 10:
        $ruta =  'index/promocion';
        $m    =  $row[5];
        break;
      case 11: // pedido  - proveedor
        $ruta = 'proveedor/pedidos';
        $m    =  $row[5];
        break;
        
      case 12:
        $ruta = 'comercial/solicitud';
        $m    = $row[5];
        break;
    }




?>
                  <tr>
                    <td>
<form action="<?= BASE_URL.$ruta ?> " method="post">
                        <input type="hidden" name="accion" value="<?= ($ac ??'' ) ?>">
                        <input type="hidden" name="documento" value="<?= ($id??'' )?>">

                        <button class="btn btn-circle btn-primary col-lg-12" type="submit">
                        <input type="hidden" name="us" value="<?= ($us??'')?>">
                          <i class="fas fa-download"></i>
                        </button> <?= $m ?>
                        

<?php
//if ($row['FK_not'] != 12) echo $row['nom_tipo'] . $m . $row['descript']; else echo $row['nom_tipo'];
?>
</form>

                    </td>
                  </tr>
              <?php  }
              } else echo "Error No ha inciado sesion"; ?>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- 
************************************
Modal notificacion
************************************
************************************
Modal mensajes
***********************************
 -->
  <div class="modal fade" id="mensaje" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Notificaciones </h5> <i class="fas fa-comment"></i>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          prueba de modal mensajes....

<?php
$ruta = APP_LIBS.'chat/index.php?exp';

include_once APP_LIBS.'chat/index.php';
?>
        </div>
      </div>
    </div>
  </div>
  <!-- 
************************************
Modal mensajes
***********************************
************************************
Vantana derecha de iconos
***********************************
 -->

  <div class="social" id="social" style="display: block;">
    <div class="">
      <!-- icono de notificacion campana -->
      <a class="" id="messagesDropdown" data-toggle="modal" data-target="#exampleModal" role="button" aria-expanded="true">
        <i class="fas fa-bell fa-fw" style="color :#ffff;"></i>
        <!-- Counter - Messages -->
        <span class="badge badge-danger badge-counter">
          <?= ((isset($notificaciones)) ? count($notificaciones) : 0)    ?> </span></span>

        <a href="<?= BASE_URL . 'cliente/compras' ?>">

          <!-- icono de mensaje-->
          <a href="<?= BASE_URL.'libs/chat2/index.php?exp=1' ?>">
          <i class="far fa-comments" style="color :#ffff;"></i></a>
           
            <!-- Counter - Messages -->
            <span class="badge badge-danger badge-counter">
              <?= ((isset($notificaciones)) ? count($notificaciones) : 0)    ?> </span></span>

            <a href="<?= BASE_URL . 'cliente/compras' ?>">

              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cart3 " fill="white" xmlns="http://www.w3.org/2000/svg">
                <path style="color :#ffff;" fill-rule="evenodd" d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"></path>
              </svg></a>
            <span class="badge badge-danger badge-counter">
              <?= ((isset($_SESSION['CARRITO'])) ? count($_SESSION['CARRITO']) : 0) ?> </span></span>
          </a>
    </div>
  </div>

  <div class="social-2" id="social-2" style="display: block;" onclick="mostrar()">
    <div class="">
    </div>
  </div>

  <script>
    $("#social").hide(2000);

    $(document).ready(function() {
      var elemento = $("#social");
      var toggle = $("#social-2")

      toggle.click(function() {
        elemento.toggle(1000);
      })
    });
  </script>

  <!-- 
************************************
Vantana derecha de iconos
***********************************
 -->



  <!-- 
***********************************
scrips mensajes
**********************************
  -->













  <!-- 
***********************************
scrips mensajes
**********************************
  -->



            <div class="col-lg-12 box-card">
                <div class="card-header border-jav">
                  <h3 class="box-title">
                     
                  </h3>
               </div>
            </div>
        </div>











<?php
}
?>